<div class="col-xs-12 col-md-12" xmlns:th="http://www.thymeleaf.org">
	<div class="page-header">
		<h1 th:text="#{fieldmap.header.field.plan}">
			FIELD PLAN
		</h1>
	</div>			  
</div>
<div class="row">
	<form class="form-inline" role="form">
		  <div  class="form-group fieldmap-header">
		    <h2 th:text="#{fieldmap.header.make.a.field.plan}">Make a Field Plan</h2>
		  </div>
		  <div   class="form-group fieldmap-header">
		    <h2 class="light" th:text="#{fieldmap.header.enter.details}">1. ENTER FIELD DETAILS</h2>
		  </div>
		  <div   class="form-group fieldmap-header">
		    <h2 th:text="#{fieldmap.header.enter.planting.details}">2. ENTER PLANTING DETAILS</h2>
		  </div>
		  <div   class="form-group fieldmap-header">
		    <h2 class="light" th:text="#{fieldmap.header.generate.field.map}">3. GENERATE FIELD MAP</h2>
		  </div>
	</form>
</div>

<form id="fieldmapForm" name="fieldmapForm" role="form-horizontal" action="#" onsubmit="return validatePlantingDetails();"
th:action="@{/Fieldmap/generateFieldmapView}" method="post" th:object="${fieldmapForm}" enctype="multipart/form-data">

<input type="hidden" id="markedCells" name="markedCells" />
<input type="hidden" id="stepValue" name="stepValue" value="2" />

	<div>
		<div class="row">&nbsp;</div>
		<div class="row">
			<div class="col-xs-12 col-md-12">
				<div class="form-group">
					<div class="col-xs-12 col-md-12" id="page-message"></div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12 col-md-12" >
				<div class="">
					<div class="col-xs-12 col-md-12">
						<label ><strong class="sub-content-heading" th:text="#{fieldmap.header.planting.details}">PLANTING DETAILS</strong></label>
					</div>
				</div>
			</div>	
		</div>
		<div class="row">
			<div class="col-xs-12 col-md-12">
				<div class="form-group">
				<div class="col-xs-2 col-md-2">
					<label class="control-label" th:text="#{fieldmap.label.starting.coordinates} + ':'">Starting Coordinates:</label>
				</div>
				<div class="col-xs-4 col-md-4">
					<input th:field="*{userFieldmap.startingColumn}" type="text" style="width: 20%;" />&nbsp;
					<strong><em th:text="#{fieldmap.label.column}">column</em></strong>
					&nbsp;&nbsp;&nbsp;
					<input th:field="*{userFieldmap.startingRange}" type="text" style="width: 20%;" />&nbsp;
					<strong><em th:text="#{fieldmap.label.range}">range</em></strong>
				</div>
				</div>
				<div class="form-group">
					<div class="col-xs-2 col-md-2">
						<label class="control-label" th:text="#{fieldmap.trial.planting.order}">Planting Order:</label>
					</div>
					<div class="col-xs-4 col-md-4">
						<div class="form-group ">
							<label class="radio-inline">
						    <input type="radio" th:field="*{userFieldmap.plantingOrder}" id="plantingOrder" value="1" th:text="#{fieldmap.planting.order.row.column}">
						    	Row/Column
						    </input>
						  	</label>
						  	<label class="radio-inline">
						    <input type="radio" th:field="*{userFieldmap.plantingOrder}" id="plantingOrder" value="2" th:text="#{fieldmap.planting.order.serpentine}">
						    	Serpentine
					    	</input>
						  	</label>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12 col-md-12">
				<div class="form-group">
					<div class="col-xs-2 col-md-2">
						<label class="control-label" th:text="#{fieldmap.label.row.capacity.machine} + ':'">Row Capacity of Planting Machine:</label>
					</div>
					<div class="col-xs-4 col-md-4">
				        <select class="form-control" th:field="*{userFieldmap.machineRowCapacity}">
				        	<option value="1">1</option>
				        	<option value="2">2</option>
				        	<option value="4">4</option>
				        	<option value="8">8</option>
					    </select>
					</div>
				</div>
			</div>
		</div>
		<div class="row">&nbsp;</div>
		<div class="row">
			<div class="col-xs-12 col-md-12" >
				
					<div class="col-xs-12 col-md-12">
						<label><strong class="sub-content-heading" th:text="#{fieldmap.header.unavailable.plots}">UNAVAILABLE PLOTS</strong></label>
					</div>
				
			</div>	
		</div>
		<div class="row">
			<div class="col-xs-12 col-md-12" >
				<div class="form-group">
					<div class="col-xs-12 col-md-12">
						<text th:text="#{fieldmap.instruction.unavailable.plots}">
						If there are any plots in this block that are unusable, mark them with an X.
						</text>
					</div>
				</div>
			</div>	
		</div>
		<div class="row">
			<div class="col-xs-12 col-md-12" >
				<div id="fieldmap-area" th:include="/Fieldmap/fieldmapView">
				</div>
			</div>	
		</div>
		<div class="row">
		<div class="col-xs-5 col-md-5">&nbsp;</div>
			<div class=" col-xs-7  col-md-7">
				<div class="form-group">
			      <input type="button" onclick="javascript: window.history.back();" href="/Fieldmap/enterFieldDetails.html" th:href="@{/Fieldmap/enterFieldDetails/trial/-10}" th:value="#{common.form.back.text}" value="Back" class="btn btn-default"/>
			      <input type="button" onclick="javascript: setAllDeletedBox();" th:value="#{common.form.next.text}" value="Next" class="btn btn-primary"/>
		      	</div>
		    </div>
	    </div>
	</div>
</form>
<div layout:fragment="page-script">
	<script type="text/javascript" th:src="@{/static/js/fieldMap.js}"></script>
	<script type='text/javascript' th:inline="javascript">
	//<![CDATA[
        var startColError = /*[[#{fieldmap.starting.coordinates.required(#{fieldmap.label.column})}]]*/;
        var startRangeError = /*[[#{fieldmap.starting.coordinates.required(#{fieldmap.label.range})}]]*/;
		var plantingOrderError = /*[[#{fieldmap.planting.order.required}]]*/;
		var startColInvalid = /*[[#{fieldmap.starting.coordinates.invalid(#{fieldmap.label.column},#{fieldmap.label.column})}]]*/;
		var startRangeInvalid = /*[[#{fieldmap.starting.coordinates.invalid(#{fieldmap.label.range},#{fieldmap.label.range})}]]*/;
		var startColNotInt = /*[[#{fieldmap.starting.coordinates.not.an.integer(#{fieldmap.label.column})}]]*/;
		var startRangeNotInt = /*[[#{fieldmap.starting.coordinates.not.an.integer(#{fieldmap.label.range})}]]*/;
		var rowNum = /*[[${fieldmapForm.userFieldmap.numberOfRowsInBlock}]]*/;
		var rangeNum = /*[[${fieldmapForm.userFieldmap.numberOfRangesInBlock}]]*/;
		var rowsPerPlot = /*[[${fieldmapForm.userFieldmap.numberOfRowsPerPlot}]]*/;
		var deletedPlots = 0;
		var totalNoOfPlots = /*[[${fieldmapForm.userFieldmap.totalNumberOfSelectedPlots}]]*/;
		var deletedPlotError = /*[[#{fieldmap.starting.coordinates.deleted}]]*/;
		var totalBlocksError = /*[[#{fieldmap.plots.exceed.blocks.with.deleted}]]*/;
		var trial = /*[[${fieldmapForm.userFieldmap.trial}]]*/;
				
	  	function setAllDeletedBox(){
			validatePlantingDetails();
	  		var deletedRect = "";
	  		deletedPlots = 0;
	  		$('#field-map td.plot.deleted').each(function(){
	  			deletedRect += $(this).attr('id');
  				if(deletedRect != ''){
  					deletedRect += ",";
  				}
  				checkDeletedPlotsHorizontal($(this).attr('id'));
	  		})
	  			  			  		
	  		if(deletedRect != ''){
	  			deletedRect = deletedRect.substr(0,deletedRect.length-1);
	  		}
	  		$('#markedCells').val(deletedRect);
	  		console.log(deletedRect);
	  		
	  		//validation that total no. of plots does not exceed total no. of blocks
	  		if (checkRemainingPlotsHorizontal()) {
	  			showMessage(totalBlocksError);
	  			return false;
			} 
			
	  		$("#fieldmapForm").submit();
	  	}
	  	$(document).ready(function() {
	  		$('#field-map td.plot').on('click', function() {
	  			if($(this).hasClass('deleted')){
	  				$(this).removeClass('deleted');
	  				$(this).html('');
	  			}else{
	  				$(this).addClass('deleted');
	  				$(this).html("<label class='alert alert-danger'>X</label>");
	  			}
	  			//console.log($(this).attr('id'));
	  		});
	  		
	  	});
    //]]>
    </script>
</div>