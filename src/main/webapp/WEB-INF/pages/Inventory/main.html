<div class="row col-xs-12 col-md-12">
    <div class="page-header">

        <span class="h1" style="float: left" th:text="#{seed.inventory.header}">
            SEED STORE INVENTORY
        </span>
    </div>
</div>

<div class="row form-group">

		<div id="page-message" class="">
		</div>

	</div>
	<div class="row form-group">
	<div class="panel panel-default">
	   	<div class="panel-body manage-settings-panel-body">

	    			<div class="row form-group collapse in germplasmListDetails">
				      	<!-- Germplasm List Tree View -->
						<div class="col-xs-3 col-md-3">
							<img th:src="@{/static/img/build-new-list.png}" style="padding-bottom:3px;" />
							<label class="control-label"><strong class="sub-content-heading">Lists</strong></label>
						</div>

				        <!-- Germplasm List Table View -->
				      	<div class="col-xs-9 col-md-9">
				      		<div id="primary-section" style="float: left; width: 70%">
				      			<img th:src="@{/static/img/build-new-list.png}" style="padding-bottom:3px;" />
				      			<label class="control-label"><strong class="sub-content-heading">Germplasm List</strong></label>
				      		</div>

				      		 <div style="float:right; ">



								<div   class="btn-group">
								  <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">
								    <span class="glyphicon glyphicon-cog"></span>&nbsp;&nbsp;Tools
								  </button>
								  <ul class="dropdown-menu" role="menu">
								    <li>
								    	<a href="javascript: addLot();" th:text="#{seed.inventory.add.lot}">Add Lot</a>
								    </li>


								  </ul>
							</div>
						</div>
						</div>
				    </div>

					<div class="row form-group collapse in germplasmListDetails">
				      	<!-- Germplasm List Tree View -->
						<div class="col-xs-3 col-md-3">
							<div id="germplasmTree" style="height:350px; overflow:auto;"></div>
							<br />
				      	</div>

				        <!-- Germplasm List Table View -->
				      	<div class="col-xs-9 col-md-9">

				      		<div id="inventory-germplasm-list" class="list-droppable primary add-border" style="float: left; width: 100%">
				      			<h3>Please drag and drop the germplasm list here</h3>
				      		</div>


						</div>


				    </div>
				</div>
			</div>
		</div>
		<div class="row form-group">
			<div th:include="/Inventory/addLotsModal"></div>
		</div>
<input type="hidden" id ="listIdSelected" />

<!-- Scripts location, note that the div tag will be remove after merging to decorator -->
<div layout:fragment="page-script">
  <script type="text/javascript" th:src="@{/static/js/inventory.js}"></script>
  <script type="text/javascript" th:src="@{/static/js/fieldbook-tree.js}"></script>
  <script type="text/javascript" th:src="@{/static/js/lib/jquery/jquery-multisortable.js}"></script>
  <script type="text/javascript" th:src="@{/static/js/lib/jquery/jquery.tablednd.0.7.min.js}"></script>
  <script type='text/javascript' th:inline="javascript">
	var isIE = false;
	</script>

<!--[if IE]>
<script type="text/javascript">
    isIE = true;
    //any other IE specific stuff here
</script>
<![endif]-->
  <script type="text/javascript" th:inline="javascript">
    //<![CDATA[
    var selectedGids = new Array();
    var listId = 0;
    var germplasmSelectError = /*[[#{seed.inventory.select.germplasm.error}]]*/;

	var locationRequired = /*[[#{seed.inventory.location.required}]]*/;
	var scaleRequired = /*[[#{seed.inventory.scale.required}]]*/;

    function do_validation() {

  		return true;
   }


  $( document ).ready(function() {


	  //display tree

	  displayGermplasmListTree("germplasmTree");

	  if(isIE){
		//no implementation yet
	  }

  });




        function do_germplasm_check(){
        	return true;
        }

        /** Germplasm Tree **/
        function displayGermplasmListTree(treeName) {

        	$("#" + treeName).dynatree({
        		title: treeName,
        		checkbox: false,
        		noLink: false,
        		autoFocus: false,
        		imagePath: "../img/",
        		activeVisible: true,
        		initAjax: {url: "/Fieldbook/ListTreeManager/loadInitGermplasmTree",
        			dataType: "json"
        		},
        		onLazyRead: function(node) {
        			node.appendAjax({
        				url: "/Fieldbook/ListTreeManager/expandGermplasmTree/" + node.data.key,
        				dataType: "json",
        				success: function(node) {
        					//do nothing
        				},
        				error: function(node, XMLHttpRequest, textStatus, errorThrown) {
        					console.log("The following error occured: " + textStatus, errorThrown);
        				},
        				cache: false
        			});
        		},
        		classNames: {
        			container: "fbtree-container",
        			expander: "fbtree-expander",
        			nodeIcon: "fbtree-icon",
        			combinedIconPrefix: "fbtree-ico-",
        			focused: "fbtree-focused",
        			active: "fbtree-active"
        		},
        		 onPostInit: function (isReloading, isError) {
        		     if(listId != 0)
        		    	 doInitialLoad(listId);
        		     	 listId = 0;
        		    },
        		onActivate: function(node) {
        			if (node.data.isFolder == false) {
         				//no implementation yet
        			}
        		},
        		dnd: {
        		      revert: false, // true: slide helper back to source if drop is rejected
        		      onDragStart: function(node) {
        		        /** This function MUST be defined to enable dragging for the tree.
        		         *  Return false to cancel dragging of node.
        		         */
        		        if(node.data.isFolder){
        		          return false;
        		        }
        		        return true;
        		      },
        		      onDragStop: function(node) {
        		        //no implementation done
        		      },
        		      onDragOver: function(node){
        		    	//no implementation done
        		      }
        		    }
        	});

        	  $(".list-droppable").droppable({
      		    hoverClass: "drophover",
      		    addClasses: true,
      		    over: function(event, ui) {
      		    //no implementation done
      		    },
      		    drop: function(event, ui) {
      		      var source = ui.helper.data("dtSourceNode") || ui.draggable;

      		     if(isFunction(source.data) == false){
	      		      if($(this).hasClass('primary')){
			      		    	//loads the primary germplasm list
			      		    	$(this).removeClass('add-border');
			      		    	displayGermplasmDetails(source.data.key);
			      		    	$('#page-message').html('');
	      		      }
      		     }
      		    }
      		  });
        }

        function isFunction(functionToCheck) {
        	 var getType = {};
        	 return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';
        	}



      //]]>
    </script>
</div>
