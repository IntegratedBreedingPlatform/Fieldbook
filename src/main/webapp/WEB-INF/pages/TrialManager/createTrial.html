<div ng-app="manageTrialApp" ng-controller="manageTrialCtrl" style="margin-bottom: 15px">
    <!-- header -->
    <div class="row col-xs-12">
        <h1 class="page-header col-xs-12">
            MANAGE TRIALS
        </h1>
    </div>

    <!-- BASIC DETAILS FORM -->
    <div class="row">
        <form action="#" th:object="${createTrialForm}" enctype="multipart/form-data" id="createTrialMainForm" role="form-horizontal">
            <div class="row add-top-bottom-padding">
                <div class="col-md-12">
                    <div class="pull-left">
                        <img class="image-padding image-padding-with-text" height="30" width="30" src="/Fieldbook/static/img/new-nursery.png"/>
                        <span class="heading">Create Trial</span>
                        <input ng-click="saveCurrentTrialData()" class="btn btn-info fbk-save-button-left-margin" onclick="" type="button" value="Save"/>
                    </div>
                    <a class="pull-right" href="/Fieldbook/TrialManager/manageTrial">Return to Manage Trials</a>
                </div>
            </div>

            <div class="row" style="height: 30px">
                <div class="col-md-12">
                    <label class="control-label">
                        <strong class="sub-content-heading">BASIC DETAILS</strong>
                    </label>
                </div>
            </div>

            <div class="row fbk-mandatory">
                <div class="col-md-12 ">
                    <label class=""><em><span class="required">*</span> indicates a mandatory field</em></label>
                </div>
            </div>

            <!-- basic details -->
            <div class="row">
                <div class="col-xs-6">
                    <div class="row form-group">
                        <label class="control-label col-sm-4"><b>Trial name</b>: <span class="required">*</span></label>

                        <div class="col-sm-8">
                            <input class="form-control character-input" type="text" ng-model="data.basicDetails[8005]"/>
                        </div>
                    </div>

                    <div class="row form-group">
                        <label class="control-label col-sm-4"><b>Description</b>: <span class="required">*</span></label>

                        <div class="col-sm-8">
                            <input class="form-control character-input" type="text" ng-model="data.basicDetails[8007]"/>
                        </div>
                    </div>

                    <div class="row form-group">
                        <label class="control-label col-sm-4"><b>Objective</b>:</label>

                        <div class="col-sm-8">
                            <textarea class="form-control character-input" rows="3" ng-model="data.basicDetails[8030]"></textarea>
                        </div>
                    </div>

                </div>

                <!-- second col -->
                <div class="col-xs-6">
                    <div class="row form-group">
                        <label class="control-label col-sm-4" id="folderLabel"><b>Save in</b>: <span class="required">*</span></label>

                        <div class="col-sm-8">              
                            <input type="hidden" id="folderId" ng-model="data.folderId"/>
		                    <input type="hidden" id="folderName" ng-model="data.folderName"/>

		                    <div class="pull-left">
		                        <label class="control-label" id="folderNameLabel" ng-bind="data.folderNameLabel"></label>
		                    </div>

                            <a class="pull-right" href="javascript: void(0)" id="chooseLocation" onclick="openStudyTree(2);">Change Folder</a>
                        </div>
                    </div>

                    <div class="row form-group">
                        <label class="control-label col-sm-4"><b>Created by</b>: <span class="required">*</span></label>

                        <div class="col-sm-8">

                            <label ng-bind="data.userName"></label>
                        </div>

                    </div>

                    <div class="row form-group">
                        <label class="control-label col-sm-4"><b>Creation date</b>: <span class="required">*</span></label>
                        <div class="col-sm-8">
                            <input class="form-control date-input" placeholder="yyyy-mm-dd" style="width: 100px" type="text" ng-model="data.basicDetails[8050]" jq-datepicker="" set-current-date-as-default="true"/>
                            <label class="btn">
                                <img style="padding-bottom:3px;" src="/Fieldbook/static/img/calendar.png"/>
                            </label>
                        </div>
                    </div>

                    <div class="row form-group">
                        <label class="control-label col-sm-4"><b>Completion date</b>:</label>

                        <div class="col-sm-8">
                            <input class="form-control date-input" placeholder="yyyy-mm-dd" style="width: 100px" type="text" ng-model="data.basicDetails[8060]" jq-datepicker=""/>
                            <label class="btn">
                                <img style="padding-bottom:3px;" src="/Fieldbook/static/img/calendar.png"/>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row form-group add_top_padding">
                <div class="col-xs-12 col-md-12">
                    <label class="label-bold">How would you like to build your trial? </label>
                </div>
            </div>

            <div class="row form-group">
                <div class="col-xs-8 col-md-8 fb-build-options">                  
                    <select id="studyBuildOption">
						<option value="1">Start with Blank Trial</option>
						<option value="2" th:text="#{trial.managesettings.use.previous.trial}">Use Previous Trial</option>
					</select>
                    &nbsp;&nbsp;
                    <input class="btn btn-info" id="choosePreviousStudy" onclick="javascript: openStudyTree(3);" type="button" value="Choose" style="display: none;"/>
                </div>
                <div class="col-xs-4 col-md-4">
                    &nbsp;
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 col-md-12">
                    &nbsp;
                </div>
            </div>
        </form>
    </div>
    <div class="form-group" id="create-trial">
		<div th:include="/Common/includes/studyTree"></div>
	</div>
    <div class="row">
        <div class="col-xs-12 col-md-12">
            <div id="showBaselineTraitDetails" th:include="/NurseryManager/includes/baselineTraitDetails"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 col-md-12">
            <div class="nrm-var-selection-modal-container" th:include="/NurseryManager/includes/variableSelectionModal"></div>
        </div>
    </div>


    <!-- tab + content -->
    <ul class="nav nav-tabs row fb-tabs-headers" id="manage-trial-tab-headers">
        <li ng-repeat="tab in trialTabs" ng-class="{active: $state.includes(tab.state)}"><a ui-sref="{{tab.state}}">{{tab.name}}</a></li>

    </ul>


    <!-- CURRENT TAB CONTENT -->
    <div class="row fb-tabs" id="manage-trial-tabs" style="padding-top: 15px;">
        <div class="info">
            <div class="col-xs-12" ui-view=""></div>
            <div class="col-xs-12" ui-view="germplasm" ng-show="$state.includes('germplasm')"></div>
        </div>
    </div>


    <!-- MAIN jS -->
    <script type="text/javascript" th:src="@{/static/js/lib/handlebars.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/nursery-manager/choose-settings.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/trial-settings-manager.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/nursery-manager/property-select.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/nursery-manager/variable-selection.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/fieldbook-common.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/trialmanager/manageTrial.js}"></script>



    <!-- constants here -->
    <script type="text/javascript" th:inline="javascript">
        //<![CDATA[
        // TODO: move the ff later as constant in the angular app module
        var nurseryFieldsIsRequired = /*[[#{nursery.create.is.required}]]*/ '';
        var varInListMessage = /*[[#{nursery.managesettings.variable.in.selected.list}]]*/ '';
        var addNurseryLevelSettings = /*[[#{trial.managesettings.add.trial.level.settings}]]*/ '';
        var addPlotLevelSettings = /*[[#{nursery.managesettings.add.plot.level.settings}]]*/ '';
        var addBaselineTraits = /*[[#{nursery.managesettings.add.baseline.traits}]]*/ '';
        var addTrialEnvironmentTraits = /*[[#{nursery.managesettings.add.trial.environment.variable}]]*/ '';
        var addTreatmentFactors = /*[[#{trial.managesettings.treatment.factors.add}]]*/ '';
        var deleteTemplateSettingError = /*[[#{manage.settings.delete.error}]]*/ '';
        var deleteTemplateSettingSuccess = /*[[#{manage.settings.delete.success}]]*/ '';
        var saveTemplateSettingSuccess = /*[[#{manage.settings.save.setting.success}]]*/ '';
        var templateSettingNameError = /*[[#{manage.settings.setting.name.error}]]*/ '';
        var templateSettingNameErrorUnique = /*[[#{manage.settings.setting.name.unique.error}]]*/ '';
        var programMethodUrl = '';
        var locationIframeOpened = false;
        var methodIframeOpened = false;
        var nurseryLevelValueEmpty= /*[[#{nursery.managesettings.nursery.level.value.empty}]]*/ '';
        var copyTemplateSettingError = /*[[#{manage.settings.copy.error}]]*/ '';
        var copyTemplateSettingSuccess = /*[[#{manage.settings.copy.setting.success}]]*/ '';
        var manageMethodLabel = /*[[#{nursery.managesettings.manage.method}]]*/ '';
        var manageLocationLabel = /*[[#{nursery.managesettings.manage.location}]]*/ '';
        var nurseryNumericError = /*[[#{manage.settings.nursery.numeric.error}]]*/ '';
        var breedingMethodId = '';
        var locationId = '';

        var showFavoriteMethodLabel = /*[[#{show.favorite.method}]]*/ '';
        var showFavoriteLocationLabel = /*[[#{show.favorite.location}]]*/ '';

        var idNameCounterpartAddedError = /*[[#{manage.settings.id.name.counterpart.added.error}]]*/ '';

        var inputChange = false;
        var reminderNursery = /*[[#{trial.reminder.add.trial.settings}]]*/ '';
        var reminderPlot = /*[[#{nursery.reminder.add.plot.settings}]]*/ '';
        var reminderTraits = /*[[#{nursery.reminder.add.trait.settings}]]*/ '';
        var reminderTrialEnvironment = /*[[#{nursery.reminder.add.trial.environment.settings}]]*/ '';
        var reminderTreatmentFactors = /*[[#{trial.reminder.add.treatment.factors}]]*/ '';

        var noVariableNameError = /*[[#{manage.settings.no.variable.name.error}]]*/ '';
        var noTreatmentFactorPairError = /*[[#{manage.settings.no.treatment.factor.pair.missing}]]*/ '';
        var noTreatmentFactorPairNameError = /*[[#{manage.settings.no.treatment.factor.pair.name.missing}]]*/ '';

        var startDateRequiredError = /*[[#{start.end.date.validation.start.date.required}]]*/ '';
        var startDateRequiredEarlierError = /*[[#{start.end.date.validation.start.date.required.earlier}]]*/ '';
        var startDateId = '';
        var endDateId = '';


        var mdLabel = /*[[#{nursery.managesettings.add.nursery.level.settings}]]*/ '',
            mdPlaceholder = /*[[#{nursery.reminder.add.nursery.settings}]]*/ '';



        (function(){

            angular.module('manageTrialApp')
            .constant('LOCATION_ID', /*[[${T(com.efficio.fieldbook.web.util.AppConstants).LOCATION_ID.getString()}]]*/ ''
            ).constant('BREEDING_METHOD_CODE', /*[[${T(com.efficio.fieldbook.web.util.AppConstants).BREEDING_METHOD_CODE.getString()}]]*/ ''
            ).constant('BREEDING_METHOD_ID', /*[[${T(com.efficio.fieldbook.web.util.AppConstants).BREEDING_METHOD_ID.getString()}]]*/ ''
            ).constant('TRIAL_SETTINGS_INITIAL_DATA', /*[[${trialSettingsData}]]*/ ''
            ).constant('ENVIRONMENTS_INITIAL_DATA', /*[[${environmentData}]]*/ ''
            ).constant('GERMPLASM_INITIAL_DATA', /*[[${germplasmData}]]*/ ''
            ).constant('TREATMENT_FACTORS_INITIAL_DATA', /*[[${treatmentFactorsData}]]*/ ''
            ).constant('EXPERIMENTAL_DESIGN_INITIAL_DATA', /*[[${experimentalDesignData}]]*/ ''
            ).constant('MEASUREMENTS_INITIAL_DATA', /*[[${measurementsData}]]*/ ''
            ).constant('BASIC_DETAILS_DATA', /*[[${basicDetailsData}]]*/ ''
            ).constant('TRIAL_VARIABLE_SELECTION_LABELS', '{}');


            $(document).ready(function() {
                document.onInitManageTrial();
            });

        })();
        

        //]]>
    </script>

    <!-- Controller js files for each tabs -->
    <script type="text/javascript" th:src="@{/static/js/trialmanager/trialSettings.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/trialmanager/germplasm.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/trialmanager/treatment.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/trialmanager/environments.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/trialmanager/experimentalDesign.js}"></script>
    <script type="text/javascript" th:src="@{/static/js/trialmanager/measurement.js}"></script>

</div>