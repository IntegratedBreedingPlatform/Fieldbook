<div class="col-xs-12 col-md-12" xmlns:th="http://www.thymeleaf.org">
	<div class="page-header">
		<h1 th:text="#{nursery.managesettings.manage.saved.nursery.settings}">
			MANAGE SAVED NURSERY SETTINGS
		</h1>
	</div>			  
</div>

<form id="saveNurserySettingsForm" role="form-horizontal" action="#" th:action="@{/NurseryManager/manageNurserySettings}" 
method="post" th:object="${manageSettingsForm}" enctype="multipart/form-data">
<div class="col-xs-12 col-md-12" xmlns:th="http://www.thymeleaf.org">
	<div class="row">
		<div id="page-message" class="col-xs-12 col-md-12 form-group">
	
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12 col-md-12">
			<div class="panel panel-default">
		    	<div class="panel-body">
		    		<div class="row form-group">
			    		<div class="col-xs-3 col-md-3 add_top_padding">
			    			<label class="control-label"> <strong th:text="#{nursery.managesettings.choose.saved.settings}+':'"> Choose Saved Settings: </strong></label>
			    		</div>
			    		
			    		<div class="col-xs-3 col-md-3">
			    			<select th:field="*{selectedSettingId}" class="form-control">
			    				<option th:each="setting : ${settingsList}" th:value="${setting.templateSettingId}" th:text="${setting.name}">Nursery Type 1</option>
			    			</select>
			    		</div>
			    		<div class="col-xs-6 col-md-6 add_top_padding">
			    			
			    			<a href="" ><img width="15" src="/Fieldbook/static/img/copy.png"/>&nbsp;  <span th:text="#{nursery.managesettings.make.copy}"></span></a>
			    			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			    			
			    			<a href="javascript: void(0)" id="addNewSettings"><span class="glyphicon glyphicon-plus"></span>&nbsp; <span th:text="#{nursery.managesettings.add.new.settings}">Add New Settings</span></a>
			    			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			    			<a href="javascript: void(0)" id="clearSettings"><span class="glyphicon glyphicon-remove"></span>&nbsp;<span th:text="#{nursery.managesettings.clear.settings}">Clear</span></a>
			    			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			    			
			    			<a href="javascript: void(0)" id="deleteSettings" ><span class="glyphicon glyphicon-trash"></span>&nbsp;<span th:text="#{common.form.delete.text}">Delete</span></a>
			    		</div>
		    		</div>
		    	</div>
	    	</div>		
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12 col-md-12">
			<div class="panel panel-default">
		    	<div class="panel-body">
		    		<div class="row form-group">
			    		<div class="col-xs-12 col-md-12">
			    			<label class="control-label"><em th:text="#{nursery.managesettings.mandatory.fields}"> Mandatory fields are noted with a *</em></label>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
			    			<label class="control-label"><strong class="sub-content-heading" th:text="#{nursery.managesettings.nursery.level.details}">NURSERY-LEVEL DETAILS</strong></label>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
			    			<label class="control-label" th:text="#{nursery.managesettings.nursery.level.notes}"> The settings in this section apply across all plots in the nursery. 
			    			You can add settings at this level, or remove those that you wish to manage at the plot level.</label>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-8 col-md-8">
	    					<table border="0" id="nurseryLevelSettings" width="100%">
								<tr th:each="nurseryLevelVariable, rowStat : *{nurseryLevelVariables}">
									<td  width="10%">
										<span th:if="${nurseryLevelVariable.delete}" class="glyphicon glyphicon-remove-circle" 
										th:onclick="'javascript: deleteVariable(1,\'' + ${nurseryLevelVariable.variable.cvTermId} + '\',$(this))'"></span>
										<input type="hidden" th:field="*{nurseryLevelVariables[__${rowStat.index}__].variable.cvTermId}" />
									</td>
									<td  width="40%"><label class="control-label" th:text="${nurseryLevelVariable.variable.name}+':*'"></label></td>
									<td  width="50%">
										<input type="hidden" th:field="*{nurseryLevelVariables[__${rowStat.index}__].value}" class="form-control select2" />
										<div th:text="${nurseryLevelVariable.value}" class="div-select-val" style="display: none"/>
										<div class="possibleValuesJson" style="display:none" th:text="${nurseryLevelVariable.possibleValuesJson}">
										</div>
									</td>
								</tr>
							</table>
	    				</div>
	    				<div class="col-xs-4 col-md-4"></div>
	    			</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					&nbsp;
	    				</div>
    				</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					<span class="glyphicon glyphicon-plus"></span>&nbsp;
			    			<a href="javascript: openAddVariablesSetting(1);" th:text="#{nursery.managesettings.add.nursery.level.settings}">Add Nursery-Level Settings</a>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					&nbsp;
	    				</div>
    				</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
			    			<label class="control-label"><strong class="sub-content-heading" th:text="#{nursery.managesettings.plot.level.details}">PLOT-LEVEL DETAILS</strong></label>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
			    			<label class="control-label" th:text="#{nursery.managesettings.plot.level.notes}"> Select the settings you will record at the plot level in the nursery. 
			    			These will appear as data columns in your nursery book. You can add and remove settings at this level.</label>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-9 col-md-9">
	    					<table class="my-class table table-curved table-condensed" id="plotLevelSettings">
	    						<thead>
								<tr>
									<th></th>
					                <th th:utext="#{nursery.managesettings.plot.name}">.Name</th>
					                <th th:utext="#{nursery.managesettings.plot.description}">.Description</th>
								</tr>
								</thead>
								<tbody>
			    					<tr th:each="plotLevelVariable, rowStat : *{plotLevelVariables}">
			    					<td style="text-align: center" th:class="${rowStat.even}? 'even' : 'odd'">
			    					
										<span th:if="${plotLevelVariable.delete}" class="glyphicon glyphicon-remove-circle"
			    						th:onclick="'javascript: deleteVariable(2,\'' + ${plotLevelVariable.variable.cvTermId} + '\',$(this))'"></span>
			    						  			    						 
			    						<input type="hidden" th:field="*{plotLevelVariables[__${rowStat.index}__].variable.cvTermId}" />
		    						</td>
			    					<td th:class="${rowStat.even}? 'even' : 'odd'" th:text="${plotLevelVariable.variable.name}"></td>
			    					<td th:class="${rowStat.even}? 'even' : 'odd'" th:text="${plotLevelVariable.variable.description}"></td>
			    					</tr> 
		    					</tbody>
	    					</table>
	    				</div>
	    				<div class="col-xs-3 col-md-3"></div>
	    			</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					&nbsp;
	    				</div>
    				</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					<span class="glyphicon glyphicon-plus"></span>&nbsp;
			    			<a href="javascript: openAddVariablesSetting(2);" th:text="#{nursery.managesettings.add.plot.level.settings}">Add Plot-Level Settings</a>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					&nbsp;
	    				</div>
    				</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
			    			<label class="control-label"><strong class="sub-content-heading" th:text="#{nursery.managesettings.baseline.traits}">BASELINE TRAITS</strong></label>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
			    			<label class="control-label" th:text="#{nursery.managesettings.baseline.traits.notes}"> The list below shows the standard traits available for Cowpea. 
			    			You can add and remove traits in this list to create the baseline set of traits you are working with in your program. 
			    			You will be able to add additional traits to measure in each nursery.</label>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-9 col-md-9">
	    					<table class="my-class table table-curved table-condensed" id="baselineTraitSettings">
	    						<thead>
								<tr>
									<th></th>
					                <th th:utext="#{nursery.managesettings.trait}">.Trait</th>
					                <th th:utext="#{nursery.managesettings.trait.description}">.Description</th>
								</tr>
								</thead>
								<tbody>
			    					<tr th:each="baselineTraitVariable, rowStat : *{baselineTraitVariables}">
			    						<td style="text-align: center" th:class="${rowStat.even}? 'even' : 'odd'" >
			    						
				    						<span th:if="${baselineTraitVariable.delete}" class="glyphicon glyphicon-remove-circle"
				    						th:onclick="'javascript: deleteVariable(3,\'' + ${baselineTraitVariable.variable.cvTermId} + '\',$(this))'"></span>
				    									    					
				    						<input type="hidden" th:field="*{baselineTraitVariables[__${rowStat.index}__].variable.cvTermId}" />
			    						</td>
				    					<td th:class="${rowStat.even}? 'even' : 'odd'" th:text="${baselineTraitVariable.variable.name}"></td>
				    					<td th:class="${rowStat.even}? 'even' : 'odd'" th:text="${baselineTraitVariable.variable.description}"></td>
			    					</tr> 
		    					</tbody>
	    					</table>
	    				</div>
	    				<div class="col-xs-3 col-md-3"></div>
	    			</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					&nbsp;
	    				</div>
    				</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					<span class="glyphicon glyphicon-plus"></span>&nbsp;
			    			<a href="javascript: openAddVariablesSetting(3);" th:text="#{nursery.managesettings.add.baseline.traits}">Add Baseline Traits</a>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					&nbsp;
	    				</div>
    				</div>
    				<!--  
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
			    			<label class="control-label"><strong class="sub-content-heading" th:text="#{nursery.managesettings.field.layout}">FIELD LAYOUT</strong></label>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-3 col-md-3">
	    					<label class="contol-label">Select Field Layout for Nursery:*</label>
	    				</div>
	    				<div class="col-xs-4 col-md-4">
	    					<select>
	    						<option>Unreplicated Design With Randomization</option>
	    					</select>
	    				</div>
	    				<div class="col-xs-5 col-md-5">
	    					<a href="">Manage Field Layouts</a>
	    				</div>
    				</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					&nbsp;
	    				</div>
    				</div>
    				<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
			    			<label class="control-label"><strong class="sub-content-heading">ADDITIONAL OPTIONS</strong></label>
		    			</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-10 col-md-10">
	    					<label class="control-label"> Will you make additional observations a about the nursery conditions during the growing season (e.g. rainfall)?: *</label>
	    				</div>
	    				<div class="col-xs-2 col-md-2">
	    					<label class="radio-inline">
							  <input checked="checked" type="radio" value="1" name="additionalObservations" id="additionalObservations" /> 
							  <span>Yes</span>
							</label>
							<label class="radio-inline">
							  <input type="radio" value="0" name="additionalObservations" id="additionalObservations"/> 
							  <span>No</span>
							</label>
	    				</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					&nbsp;
	    				</div>
    				</div>
    				-->
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					<label class="control-label"><strong class="sub-content-heading" th:text="#{nursery.managesettings.save.settings}">SAVE SETTINGS</strong></label>
	    				</div>
    				</div>
    				<div class="row form-group">
	    				<div class="col-xs-5 col-md-5">
	    					<label class="contol-label" th:text="#{nursery.managesettings.save.settings.as}+':'">Save these settings as:</label>
	    					&nbsp;&nbsp;
	    					<input type="text" th:field="*{settingName}" />
	    				</div>
	    				<div class="col-xs-7 col-md-7 add_top_padding">
	    					<input type="checkbox" th:field="*{isDefault}" /> 
	    					<label class="control-label" th:text="#{nursery.managesettings.set.default}"> Set as default for this program (overrides previous defaults)</label>
	    				</div>
	    			</div>
	    			<div class="row form-group">
	    				<div class="col-xs-12 col-md-12">
	    					&nbsp;
	    				</div>
    				</div>
	    			<div class="row form-group">
	    				<div class="col-xs-5 col-md-5">
	    				</div>
	    				<div class="col-xs-2 col-md-2">
	    					<input type="button" onclick="javascript: window.history.back();"  value="Cancel" th:value="#{common.form.cancel.text}" class="btn btn-default"/>
	    					<input type="button" value="Save" id="saveSettings" th:value="#{common.form.save.text}" class="btn btn-primary" />
	    				</div>
	    				<div class="col-xs-5 col-md-5">
	    				</div>
    				</div>
		    	</div>
	    	</div>	
		</div>
	</div>
	<div class="row">
		<div class="col-xs-12 col-md-12">
			<div th:include="/NurseryManager/addVariablesSettingModal"></div>
		</div>
	</div>
</div>

<div class="modal fade" id="delete-settings-confirmation">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Confirmation</h4>
      </div>
      <div class="modal-body">
        <p th:text="#{manage.settings.delete.confirmation}">Do you realy want to delete this configuration?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="javascript: hideDeleteConfirmation();">No</button>
        <button type="button" class="btn btn-primary" onclick="javascript: deleteNurserySettings();">Yes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</form>
<div layout:fragment="page-script">
<script type="text/javascript" th:src="@{/static/js/nurseryManager.js}"></script>
<script type='text/javascript' th:inline="javascript">
	//<![CDATA[   
            var varInListMessage = /*[[#{nursery.managesettings.variable.in.selected.list}]]*/;
            var addNurseryLevelSettings = /*[[#{nursery.managesettings.add.nursery.level.settings}]]*/;
            var addPlotLevelSettings = /*[[#{nursery.managesettings.add.plot.level.settings}]]*/;
            var addBaselineTraits = /*[[#{nursery.managesettings.add.baseline.traits}]]*/; 
            var deleteTemplateSettingError = /*[[#{manage.settings.delete.error}]]*/;
            var deleteTemplateSettingSuccess = /*[[#{manage.settings.delete.success}]]*/;
       		var saveTemplateSettingSuccess = /*[[#{manage.settings.save.setting.success}]]*/;
       		var templateSettingNameError = /*[[#{manage.settings.setting.name.error}]]*/;
       		var templateSettingNameErrorUnique = /*[[#{manage.settings.setting.name.unique.error}]]*/;
       		
            
 			$( document ).ready(function() {
 				$('#selectedSettingId').on('change', function(){
 					//alert('load settings' + $(this).val());
 					loadNurserySettings($(this).val());
 					
 				})
 				$('#deleteSettings').on('click', function(){
 					if($('#selectedSettingId').val() == '0'){
 						showErrorMessage('page-message', deleteTemplateSettingError);	
 					}else{ 						
 	 					$('#delete-settings-confirmation').modal('show');	
 					} 					 					
 				});
 				$('#clearSettings').on('click', clearSettings);
 				$('#saveSettings').on('click', doSaveSettings);
 				$('#addNewSettings').on('click', addNewSettings);
 				
 				$.each($(".possibleValuesJson"), function (index, divElem){
 					if (index == 0) {
 						initializePossibleValuesCombo($.parseJSON(divElem.innerHTML), 
 		 			 			"#" + getJquerySafeId("nurseryLevelVariables0.value"), true, $(divElem).siblings(".div-select-val").html());
 						//console.log($(divElem).siblings(".div-select-val").html());
 					} else {
 						initializePossibleValuesCombo($.parseJSON(divElem.innerHTML), 
 		 			 			"#" + getJquerySafeId("nurseryLevelVariables"+index+".value"), false, $(divElem).siblings(".div-select-val").html());
 						//console.log($(divElem).siblings(".div-select-val").html());
 					}
 					
 				});
 			});    			 			     
			
      //]]>
    </script>
	
</div>