<div class="col-xs-7 col-md-7" xmlns:th="http://www.thymeleaf.org">
	
	<!-- Modal -->
	<form id="importStudyUploadForm" 	
    method="post" th:object="${createNurseryForm}" 
    enctype="multipart/form-data">
   	<div class="modal fade" id="importStudyModal" role="dialog" aria-labelledby="importStudyModal" aria-hidden="true">
		<div class="modal-dialog modal-medium">
	    	<div class="modal-content">
			    	<div class="modal-header">
		            <button id="close" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		            <h4 class="modal-title" id="heading-modal">
		            Import
	         		</h4>
		          </div>
		          
	         	<div class="modal-body" id="importStudyModalBody">
	         		<div class="row form-group">
		         		<div id="page-import-message-modal" class="col-xs-12 col-md-12">
		         		</div>
	         		</div>	         		
					
					<div class="row form-group">
						<div class="col-xs-12 col-md-12">
							<label class="control-label h4" th:text="#{study.import.select.header}"></label>
						</div>
						
			        </div>
			        
	         		<div class="row form-group">
						<div class="col-xs-7 col-md-7">
							<label th:text="#{study.import.specify.format}" class="control-label add_top_padding"></label><span class="required">*</span>
						</div>
						<div class="col-xs-5 col-md-5">
							<select style="width: 205px" id="importType">
								<option value="0">Please Choose</option>
								<option value="1" th:text="#{nursery.import.fieldlog.fieldroid}"></option>
								<option value="3" th:text="#{nursery.import.excel}"></option>															
							</select>
						</div>
			        </div>
			        			        
			        <div class='row form-group'>                                          
              
		                <div class="col-xs-7 col-md-7">
							<label for="fileupload" class="control-label" th:text="#{nursery.import.germplasm.select.file}">Select a file</label><span class="required">*</span>
						</div>
						<div class="col-xs-5 col-md-5">
							<div class="fileupload fileupload-new" data-provides="fileupload">							    
				                <div class="input-group">
				                  <div class="form-control uneditable-input"><i class="icon-file fileupload-exists"></i> 
				                  <span class="fileupload-preview"></span>
				                </div>
				                <div class="input-group-btn">
				                  <a class="btn btn-info btn-file">
				                    <span class="fileupload-new" th:text="#{nursery.import.germplasm.browse.file}">Browse</span>
				                    <span class="fileupload-exists" th:text="#{nursery.import.germplasm.change}">Change</span>
				                    <input id="fileupload" th:field="*{file}" type="file" class="file-input"/></a>
				                    <a href="#" class="btn btn-danger fileupload-exists" data-dismiss="fileupload" th:text="#{nursery.import.germplasm.remove}">Remove</a>
				                  </div>
				                </div>
				              </div>
						</div>
						
			              
			          </div>
			        
	         	</div>		
	         																						
	       		<div class="modal-footer">    	       			
	       			<button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true" th:text="#{common.form.cancel.text}">Cancel</button>
	       			<button type="button" class="btn btn-primary" aria-hidden="true" onclick="javascript:submitImportStudy();">Import</button>	
       			</div>
	     	</div><!-- /.modal-content -->
   		</div><!-- /.modal-dialog -->
	</div><!-- /.modal -->	
	</form>
</div>

<div layout:fragment="page-script">
	<script type="text/javascript" th:src="@{/static/js/bootstrap-fileupload.js}"></script>
	<script type="text/javascript" th:src="@{/static/js/jquery.form.js}"></script>
	<script type='text/javascript' th:inline="javascript">
	//<![CDATA[    
	           
	           var importStudyHeader = /*[[#{study.import.study.header}]]*/;
	           var importStudyBookHeader = /*[[#{study.import.study.book.header}]]*/;
	          
	        	   
	
	           var importOptions = { 
			        success:       showImportResponse  // post-submit callback 
			    }; 
		   	$( document ).ready(function() {  	     
				$('#importStudyModal select').select2({width: 'copy'});
				$('#importType').on('change', function(){
					if($(this).val() != 0){
						importNursery($(this).val());
					}
				});
				 
				$('#importStudyModal').on('hide.bs.modal', function() {
				    $("#page-import-message-modal").html('');	
				    $('#fileupload').val("");
				    $('div.fileupload').parent().parent().removeClass('has-error');
				    $('#importStudyModal .fileupload-exists').click();
				})
				
				$('#importStudyModal #heading-modal').html(importStudyHeader + " " +  $("#study-type").val() + " " + importStudyBookHeader);
		    });
		   	
		   	
		   	function showImportResponse(responseText, statusText, xhr, $form)  { 
		        //reload the screen
		        if(responseText.isSuccess == 1){
		        	var paginationUrl = '/Fieldbook/Common/addOrRemoveTraits/reload/'; 
	        		paginationUrl = paginationUrl + $("#study-type").val() + "/";
	        		var currentPage = $('#measurement-data-list-pagination .pagination .active a').html();
	        
	        		$.ajax(
	        		         { url: paginationUrl+currentPage+"/"+currentPage+'?r=' + (Math.random() * 999),
	        		           type: "GET",
	        		           data: "",
	        		           cache: false,
	        		           timeout: 70000,
	        		           success: function(html) {
	        		        	   
	        		             $("#germplasm-measurement-list-table-div").empty().append(html);        		                     		                     		             
	        		             Spinner.toggle();  
	        		             $('#importStudyModal').modal('hide');
	        		           }
	        		         }
	        		       );
		        }else{
		        	showErrorMessage('page-import-message-modal', responseText.error);
		        	 Spinner.toggle();  
		        }		         
		    }
    //]]>
    </script>
</div>