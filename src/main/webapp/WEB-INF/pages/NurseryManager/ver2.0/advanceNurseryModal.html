<div class="col-xs-10 col-md-10" xmlns:th="http://www.thymeleaf.org">
<form onsubmit="javascript: return validateAdvanceNursery();" id="advanceNurseryModalForm" role="form-horizontal" action="#"
th:action="@{/NurseryManager/advance/nursery}" method="post" th:object="${advancingNurseryform}" enctype="multipart/form-data">

<input type="hidden" th:field="*{locationUrl}"/>
<input type="hidden" th:field="*{breedingMethodUrl}"/>
<input type="hidden" th:field="*{defaultMethodId}"/>
<input type="hidden" th:field="*{nurseryId}"/>

<div class="modal fade" id="advanceNurseryModal" role="dialog" aria-labelledby="advanceNurseryModal" aria-hidden="true">
	<div class="modal-dialog modal-large">
    	<div class="modal-content">
			<div class="modal-header">
				<button id="closeAdvanceNurseryModal" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="heading-modal" th:text="#{nursery.nurserydetails.action.advance}">Advance Nursery</h4>
			</div>
	          
         	<div class="modal-body">
         		<div class="row">
	         		<div id="page-block-message-modal" class="col-xs-12 col-md-12">
	         		</div>
         		</div>	         		

				<div class="row">
					<div class="col-xs-12 col-md-12" >
						<label class=""><em th:utext="#{fieldmap.mandatory.fields}"> Mandatory fields are noted with a *</em></label>
					</div>		
				</div>
			
				<br />
				<div class="row form-group col-xs-12 col-md-12">
					<div class="row form-group col-xs-12 col-md-12">
						<label class="control-label" ><strong class="sub-content-heading"  th:text="#{advancing.nursery.convention}"></strong></label>
					</div>
					<div class="row form-group col-xs-6 col-md-6">
						<strong><label th:text="#{advancing.nursery.naming.convention}+'*:'"></label></strong>
						&nbsp;&nbsp;
						<select id="namingConvention">
						  <option th:if="*{cropType == 1}" value="1" th:text="#{advancing.nursery.naming.convention.cimmyt.wheat}">CIMMYT-WHEAT</option>
						  <option th:if="*{cropType == 2}" value="2" th:text="#{advancing.nursery.naming.convention.cimmyt.maize}">CIMMYT-MAIZE</option>
						  <option value="3" th:text="#{advancing.nursery.naming.convention.other.crops}">OTHER CROPS</option>					  
						</select>
					</div>		
				</div>
			
				<br/>
				<div class="row form-group col-xs-12 col-md-12">
					<div class="row form-group col-xs-12 col-md-12">
						<label class="control-label" ><strong class="sub-content-heading"  th:text="#{advancing.nursery.method}">METHODS</strong> </label>
					</div>
					<div class="row form-group col-xs-6 col-md-6">
						<label class="control-label">
							<input type="checkbox" th:field="*{lineChoice}" value="*{lineChoice}"/>
							<span th:text="#{advancing.nursery.breeding.method.the.same}">Breeding Method is the same for each advance</span>
						</label>														
					</div>
					<div class="row form-group col-xs-6 col-md-6">					
						<input type="hidden" th:field="*{methodIdAll}" class="form-control select2 non-maize-control" placeholder=""/>
						<input type="hidden" th:field="*{methodIdFavorite}" class="form-control select2 non-maize-control" placeholder=""/>
						<select id="maizeBreedingMethod" class="form-control maize-control">
							<option value="1" th:text="#{advance.nursery.maize.breeding.method.selfed.shelled}">Selfed and ears shelled individually (-)</option>
							<option value="2" th:text="#{advance.nursery.maize.breeding.method.selfed.bulked}">Selfed and ears bulked (-B)</option>
							<option value="3" th:text="#{advance.nursery.maize.breeding.method.sib.increased}">Sib-Increased (-#)</option>
							<option value="4" th:text="#{advance.nursery.maize.breeding.method.colchicinize}">Colchicinize</option>					  
						</select>
						<input type="hidden" th:field="*{breedingMethodId}"/>	
					</div>
					<div class="row form-group col-xs-6 col-md-6">
					</div>
					<div class="row form-group col-xs-6 col-md-6">					
						<label class="non-maize-control">
							<input id="showFavoriteMethod" value="1" type="checkbox"/> <span th:text="#{show.favorite.method}">Show Favorite Method</span>
							&nbsp;&nbsp;
							<a class="form-group" href="javascript: openManageMethods()" th:text="#{advancing.nursery.manage.method}">Manage Methods</a>	
						</label>
					</div>
					<div class="row form-group col-xs-6 col-md-6">
						<label class="control-label" th:text="#{advancing.nursery.method.variate} + ':'">Choose a variate that defines the breeding method for each advance:</label>
					</div>
					<div class="row form-group col-xs-6 col-md-6">
						<select th:field="*{methodVariateId}">
							<option th:each="methodVariate : *{methodVariates}" th:value="${methodVariate.id}" th:text="${methodVariate.description}">
							</option>
						</select>
					</div>
				</div>

				<br/>
				<div class="row form-group col-xs-12 col-md-12">
					<div class="row form-group col-xs-12 col-md-12">
						<label class="control-label" ><strong class="sub-content-heading"  th:text="#{advancing.nursery.lines}">LINES</strong> </label>
					</div>
					<div class="row form-group col-xs-6 col-md-6">
						<label class="control-label">
							<input type="checkbox" th:field="*{lineChoice}" value="*{lineChoice}"/>
							<span th:text="#{advancing.nursery.line.the.same}">Same number of lines is selected for each plot</span>
						</label>
					</div>
					<div class="row form-group col-xs-6 col-md-6">
					</div>
				</div>
				<div class="row form-group col-xs-12 col-md-12">
					<input type="hidden" th:field="*{plotsWithPlantsSelected}" />
					<div class="row form-group col-xs-6 col-md-6">
						<label class="control-label" th:text="#{advancing.nursery.number.of.samples.plot} + ':'">Lines Selected per Plot:</label>														
					</div>
					<div class="row form-group col-xs-6 col-md-6">
						<input class="form-control" type="text" th:field="*{lineSelected}"/>
					</div>										
					<div class="row form-group col-xs-6 col-md-6">
						<label class="control-label" th:text="#{advancing.nursery.lines.variate}"></label>
					</div>
					<div class="row form-group col-xs-6 col-md-6">
						<select th:field="*{lineVariateId}">
							<option th:each="lineVariate : *{lineVariates}" th:value="${lineVariate.id}" th:text="${lineVariate.description}">
							</option>
						</select>
					</div>
				</div>
				
				<br/>
				<div class="row form-group col-xs-12 col-md-12">
					<div class="row form-group col-xs-12 col-md-12">
						<label class="control-label" ><strong class="sub-content-heading"  th:text="#{advancing.nursery.harvest.information}">Harvest Details</strong> </label>
					</div>
					<div class="row form-group col-xs-6 col-md-6">
					  	<label class="control-label" th:text="#{advancing.nursery.harvest.location}">Harvest Location:</label><span class="required"></span>
					</div>
					<div class="row form-group col-xs-6 col-md-6">
					   <input type="hidden" th:field="*{harvestLocationIdAll}" class="form-control select2" placeholder=""/>
					   <input type="hidden" th:field="*{harvestLocationIdFavorite}" class="form-control select2" placeholder=""/>
					   <input type="hidden" th:field="*{harvestLocationId}"/>
					   <input type="hidden" th:field="*{harvestLocationName}" />
					   <input type="hidden" th:field="*{harvestLocationAbbreviation}" />
				    </div>
					<div class="row form-group col-xs-6 col-md-6">
					</div>
					<div class="row col-xs-6 col-md-6 form-group">
						<label>
							<input id="showFavoriteLocation" value="1" type="checkbox"/> <span th:text="#{show.favorite.location}">Show Favorite Location</span>
							&nbsp;&nbsp;
					  		<a href="javascript: openManageLocations()" th:text="#{advancing.nursery.manage.location}">Manage Locations</a>	
						</label>
				    </div>
					<div class="row form-group col-xs-12 col-md-12">
						<div class="row form-group col-xs-6 col-md-6">
							<label for="harvestDate" class="control-label"  th:text="#{advancing.nursery.harvest.date}">Harvest Date</label><span class="required"></span>
						</div>	
						<div class="row col-xs-12 col-md-12 form-group">
						   	<div class="col-xs-1 col-md-1 input-group date" id="dp3" data-date="" data-date-format="yyyymmdd">
							     <input th:field="*{harvestDate}" class="form-control" type="text"  style="width: 100px"  />
								 <label for="harvestDate" class="input-group-addon btn datepicker"><i class="glyphicon glyphicon-calendar"></i></label>
							</div>
						</div>
					</div>
				</div>							


			</div> <!-- Modal Body -->
			
			<div class="modal-footer">    	       			
				<button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true" th:text="#{common.form.cancel.text}">Cancel</button>
				<button type="button" class="btn btn-primary" aria-hidden="true" onclick="javascript: callAdvanceNursery();" th:text="#{common.form.finish.text}">Finish</button>	
			</div>
			
					
		</div> <!-- Modal Content -->
	</div>
</div>

</form>
</div>

<div class="row">
	<div id="manage-method" th:include="/Common/manageMethodsModal"></div>
</div>
<div class="row">
	<div id="manage-location" th:include="/Common/manageLocationsModal"></div>
</div>


<div layout:fragment="page-script">
<script type='text/javascript' th:inline="javascript">
//<![CDATA[    
    var locationSuggestions = /*[[${locationList}]]*/ null;
    var locationSuggestions_obj = [];
    
    var locationSuggestionsFav = /*[[${favoriteLocationList}]]*/ null;
    var locationSuggestionsFav_obj = [];
    
    var methodSuggestions = /*[[${methodList}]]*/ null;
    var methodSuggestions_obj = [];
    
    var methodSuggestionsFav = /*[[${favoriteMethodList}]]*/ null;
    var methodSuggestionsFav_obj = [];
    
    
    var msgSamplePlotError = /*[[#{advancing.nursery.number.of.plot.error}]]*/;
   	var msgHarvestDateError = /*[[#{advancing.nursery.harvest.date.error}]]*/;
   	var msgMethodError = /*[[#{advancing.nursery.method.error}]]*/;
   	var programLocationUrl = '';
   	var programMethodUrl = '';
   	
    var oldLineSelected = "";
    var oldMethodSelected = "";
    
    var locationIframeOpened = false;
    var methodIframeOpened = false;
    
    var msgEmptyListError = /*[[#{nursery.advance.nursery.empty.list.error}]]*/;
    
		 $(function() {
			loadNurseryDetails();
			var harvestDate =  $('#harvestDate').datepicker({'format': 'yyyymmdd'}).on('changeDate', function(ev) {
				$(this).datepicker('hide');
			})
			
			programMethodUrl = $('#breedingMethodUrl').val();
			programLocationUrl = $('#locationUrl').val();
			/*
			initializeHarvestLocationSelect2(locationSuggestions, locationSuggestions_obj);
			initializeHarvestLocationFavSelect2(locationSuggestionsFav, locationSuggestionsFav_obj);
			
			initializeMethodSelect2(methodSuggestions, methodSuggestions_obj);
			initializeMethodFavSelect2(methodSuggestionsFav, methodSuggestionsFav_obj);
			*/
			recreateLocationCombo();
			recreateMethodCombo();
			
			$('#s2id_harvestLocationIdFavorite').hide();
			$('#s2id_harvestLocationIdAll').show();
			
			$('#s2id_methodIdFavorite').hide();
			$('#s2id_methodIdAll').show();
			
			
			$('#showFavoriteLocation').on('change', function(){
				showCorrectLocationCombo();
			})
			$('#showFavoriteMethod').on('change', function(){
				showCorrectMethodCombo();
			});
			
			 $('input[type=radio][name=methodChoice]').on('change', checkMethod);
			 
			$('input[type=radio][name=lineChoice]').on('change', lineMethod);
			
			$('#namingConvention').on('change', changeSuffix);
			$('#maizeBreedingMethod').on('change', changeMaizeBreedingMethod);
			oldMethodSelected = $('#defaultMethodId').val();
			oldLineSelected = $('#lineSelected').val();
			checkMethod();
			lineMethod();
			changeSuffix();
			
			
		});
		 
		function changeMaizeBreedingMethod(){
			 $('#'+getJquerySafeId("breedingMethodId")).val($('#maizeBreedingMethod').val());
		}
		function changeSuffix(){
			if($('#namingConvention').val() == 3){
				//show
				$('#suffix-div').show();
			}else{
				//hide
				$('#suffix-div').hide();
			}	
			
			if($('#namingConvention').val() == 1){
				//if its wheat, we disable the method section
				$('.method-section input').attr('disabled', true);
				$('#methodIdAll').select2('enable', false);
				$('#methodIdFavorite').select2('enable', false);
				
			}else{
				$('.method-section input').attr('disabled', false)
				$('#methodIdAll').select2('enable', true);
				$('#methodIdFavorite').select2('enable', true); 				
			}
			
			if($('#namingConvention').val() == 2){
				//meaning maize
				adjustMaizeControl(true);
		}else{
			adjustMaizeControl(false);
		}
		}
		function adjustMaizeControl(isShow){
			//console.log(isShow);
			if(isShow){
				$('.maize-control').css('display', 'block');
				$('.non-maize-control').css('display', 'none');
				changeMaizeBreedingMethod();
			}else{
				$('.maize-control').css('display', 'none');
				$('.non-maize-control').css('display', 'block');
				showCorrectMethodCombo();
			}
		}
		function loadNurseryDetails(){
			Spinner.toggle();
			$.ajax(
					{ url: "/Fieldbook/NurseryManager/advance/nursery/load/"+$('#nurseryId').val(),
				       type: "GET",
				       cache: false,
				       data: "",
				       success: function(data) {
				    	   //console.log('done');
				    	  Spinner.toggle();
				       }
				        
				     }
					);
		
		}
//]]>
</script>
</div>