<div class="col-md-12" xmlns:th="http://www.thymeleaf.org">

	<div class="page-header">
		<h1 th:text="#{nursery.savenursery.header}">
			Step 4: Save Nursery
		</h1>
		
		<div class="progress">
		  <div id="progressbar" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%;">
		    <span class="sr-only" th:text="#{nursery.savenursery.80percent.complete}">80% Complete</span>
		  </div>
		</div>
	</div>

	<div id="page-message" style="display:none;">
	        <div id="error-message" class="alert alert-danger"></div> 
	</div>

	<form id="nurseryForm" class="form-horizontal" action="#" 
		th:action="@{/NurseryManager/saveNursery}" method="post" th:object="${saveNurseryForm}" enctype="multipart/form-data">

		<div class="form-group">
			<div class="control-group">
				<label class="col-lg-2 control-label" for="title" th:text="#{nursery.savenursery.title} + ':*'">Title:*</label>
				<div class="col-lg-10">
					<input type="text" class="form-control" th:field="*{title}" />
				</div>
			</div>
		</div>
		<div class="form-group">
			<div class="control-group">
				<label class="col-lg-2 control-label" for="objective" th:text="#{nursery.savenursery.objective} + ':*'">Objective:*</label>
				<div class="col-lg-10">
					<input type="text" class="form-control" th:field="*{objective}" />
				</div>
			</div>
		</div>
		<div class="form-group">
			<div class="control-group">
				<label class="col-lg-2 control-label" for="nurseryBookName" th:text="#{nursery.savenursery.nurseryBookName} + ':*'">Nursery Book Name:*</label>
				<div class="col-lg-10">
					<input type="text" class="form-control" th:field="*{nurseryBookName}" />
				</div>
			</div>
		</div>
		
		<div class="form-group">
			<div id="saving-progress" style="display:none;" class="progress progress-striped active">
	  			<div class="progress-bar"  role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
			</div>
		</div>
			
		<div class="form-group">
			<div class="col-lg-offset-2 col-lg-10">
				<input type="button" onclick="history.go(-1);" th:value="#{common.form.back.text}" class="btn btn-primary btn-lg" />
				<input type="button" th:value="#{common.form.finish.text}" class="btn btn-primary btn-lg" onclick="doSave();" />
			</div>
		</div>
	</form>
	
</div>


<script>

	function doSave() {
		var $form = $("#nurseryForm");
		$inputs = $form.find("input, select, button, textarea");
		serializedData = $form.serialize();
		$inputs.attr("disabled", "disabled");
		$("#saving-progress").show();
		
		$.ajax({
			url: "saveNursery",
			type: "post",
			dataType: "json",
			data: serializedData,
		    success: function(data){
			    if (data.status == "1") {
		    		window.location = "successful";
		       	} else {
		       		$("#error-message").html(data.errorMessage);
		       		$("#page-message").show();
		       	}
		   }, 
		   error: function(jqXHR, textStatus, errorThrown){ 
				console.log("The following error occured: " + textStatus, errorThrown); 
		   }, 
		   complete: function(){ 
		       $inputs.removeAttr("disabled"); 
			   	$("#saving-progress").hide();
		   } 
		});
	}
</script>