<!-- // FIXME: Refactor this page NOT to use thymeleaf and make this an AngularJS html template-->
<div class="modal-body" id="advanceStudyModal">
	<form onsubmit="javascript: return validateAdvanceStudy();" id="advanceStudyModalForm" role="form-horizontal" action="#" th:action="@{/StudyManager/advance/study}" method="post" th:object="${advancingStudyForm}" enctype="multipart/form-data">

		<input type="hidden" th:field="*{breedingMethodUrl}"/>
		<input type="hidden" th:field="*{defaultMethodId}"/>
		<input type="hidden" th:field="*{studyId}"/>
		<input type="hidden" th:field="*{harvestDate}"/>
		<input type="hidden" th:field="*{selectedTrialInstances}"/>
		<input type="hidden" th:field="*{advanceType}"/>
		<!-- Instead of type="hidden", make it text input so that ng-model will work. -->
		<input type="text" style="display:none;" th:field="*{advanceBreedingMethodId}" ng-model="valueContainer.selectedBreedingMethod.mid"/>

		<div class="row form-group">
			<div class="col-xs-11 col-md-11" id="advanceTrialModalHeader">
				<label class="modal-title fbk-modal-title" th:if="${advanceType} == 'sample'"
					   th:text="#{study.studydetails.action.advance.sample}"></label>
				<label class="modal-title fbk-modal-title" th:if="${advanceType} != 'sample'"
					   th:text="#{study.studydetails.action.advance.study}"></label>
			</div>
			<div class="col-xs-1 col-md-1">
				<button id="closeAdvanceStudyModal" type="button" class="close  pull-right glyphicon glyphicon-remove" data-dismiss="modal" aria-hidden="true" ng-click="close()"/>
			</div>
		</div>

		<div class="row form-group">
			<div id="page-advance-modal-message"></div>
		</div>

		<div class="row form-group">
			<div class="col-xs-12 col-md-12">
				<label class=""><em th:utext="#{fieldmap.mandatory.fields}"> Mandatory fields are noted with a *</em></label>
			</div>
		</div>
		<br/>
		<div id="methods-section">

			<div class="row form-group">
				<label class="control-label col-xs-12">
					<strong class="sub-content-heading" th:text="#{advancing.study.method}">METHODS</strong><span
					class="required" th:if="${advanceType} == 'sample'">*</span>
				</label>
			</div>

			<div class="row form-group">
				<label th:if="${advanceType} != 'sample'" class="control-label col-xs-6">
					<input type="checkbox" th:field="*{methodChoice}" th:value="*{methodChoice}" ng-model="valueContainer.methodChoice" ng-change="validateMethodChoice()"/>
					<span class="label-bold" th:text="#{advancing.study.breeding.method.the.same}">
										Breeding Method is the same for each advance
									</span>
				</label>
				<label th:if="${advanceType} == 'sample'" class="control-label col-xs-6">
									<span class="label-bold" th:text="#{study.advance.sample.breeding.method.label}">
										Breeding method
									</span>
				</label>

				<div class="row col-xs-6">
					<div class="col-xs-10 method-selection-div">
						<methods-select on-method-select="methodChanged" enable-dropdown="valueContainer.methodChoice" show-gen-methods-radio="false" show-der-man-methods-radio="true" method-type="1"
										disable-method-types-radio="true" valuecontainer="valuecontainer" targetkey="targetkey"></methods-select>
					</div>
					<div class="col-xs-2 method-selection-div help-tooltip-col">
						<span data-container="#advanceStudyModal .modal-body" id="method-tooltip" class="bms-fa-question-circle help-tooltip-study help-tooltip-study-advance" data-placement="top" data-toggle="tooltip" style="display:inline;"></span>
					</div>
				</div>
			</div>
			<div class="row form-group">
				<div class="col-sm-offset-6 col-xs-6 method-selection-div">
					<label class="non-maize-control">
						<a class="advance-manage-method" href="javascript: void(0)" th:text="#{advancing.study.manage.method}">Manage Methods</a>
					</label>
				</div>
			</div>

			<div class="row form-group" id="method-variates-section" th:if="${advanceType} != 'sample'" ng-if="!valueContainer.methodChoice">
				<div class="col-xs-6">
					<label class="control-label label-bold" th:text="#{advancing.study.method.variate} + ':'">Choose a variate that defines the breeding method for each advance:</label>
				</div>
				<div class="col-xs-6">
					<select id="methodVariateId" name="methodVariateId" ng-model="valueContainer.methodVariateId" style="width: 90%">
						<option ng-repeat="option in selectionMethodVariables" value="{{option.termId}}">{{option.name}}</option>
					</select>
				</div>
			</div>
		</div>

		<div class="lines-section" th:if="${advanceType} != 'sample'" ng-show="!valueContainer.methodChoice || !isBulkingMethod()">
			<div class="row form-group">
				<label class="control-label col-xs-12 add_top_padding"><strong class="sub-content-heading" th:text="#{advancing.study.lines}">LINES</strong> </label>
			</div>
			<div class="row form-group ">
				<label class="control-label col-xs-6">
					<input type="checkbox" th:field="*{lineChoice}" th:value="*{lineChoice}" ng-model="valueContainer.lineChoice" ng-change="validateLineChoice()"/>
					<span class="label-bold" th:text="#{advancing.study.line.the.same}">Same number of lines is selected for each plot</span>
				</label>
			</div>

			<div class="row form-group lines-per-plot-section" ng-if="valueContainer.lineChoice">
				<label class="control-label label-bold col-xs-6" th:text="#{advancing.study.number.of.samples.plot} + ':'">Lines Selected per Plot:</label>

				<div class="col-xs-3">
					<input class="form-control" type="text" th:field="*{lineSelected}" maxlength="3" style="width: 100%"/>
				</div>

			</div>
			<div class="row form-group" id="line-variates-section" ng-if="!valueContainer.lineChoice">
				<label class="control-label label-bold col-xs-6" th:text="#{advancing.study.lines.variate}"></label>
				<div class="col-xs-6">
					<select id="lineVariateId" name="lineVariateId" class="ps-variate-selection" style="width: 90%" ng-model="valueContainer.lineVariateId">
						<option ng-repeat="option in selectionPlantVariables" value="{{option.termId}}" ng-selected="$first">{{option.name}}</option>
					</select>
				</div>
			</div>
		</div>
		<div class="bulk-section" th:if="${advanceType} != 'sample'" ng-show="!valueContainer.methodChoice || isBulkingMethod()">
			<div class="row form-group">
				<label class="control-label col-xs-12 add_top_padding"><strong class="sub-content-heading" th:text="#{advancing.study.bulks}">BULKS</strong> </label>
			</div>
			<div class="row form-group">
				<label class="control-label col-xs-6">
					<input type="checkbox" th:field="*{allPlotsChoice}" th:value="*{allPlotsChoice}" ng-model="valueContainer.allPlotsChoice" ng-change="validatePlotChoice()"/>
					<span class="label-bold" th:text="#{advancing.study.all.plots.selected}">All plots are selected</span>
				</label>
			</div>

			<div class="row form-group" id="plot-variates-section" ng-if="!valueContainer.allPlotsChoice">
				<div class="col-xs-6">
					<label class="control-label label-bold" th:text="#{advancing.study.bulks.variate}"></label>
				</div>
				<div class="col-xs-6">
					<select id="plotVariateId" name="plotVariateId" ng-model="valueContainer.plotVariateId" style="width: 90%">
						<option ng-repeat="option in selectionPlantVariables" value="{{option.termId}}" ng-selected="$first">{{option.name}}</option>
					</select>
				</div>
			</div>
		</div>

		<div class="plants-section" th:if="${advanceType} == 'sample'">
			<!-- static content for now -->
			<!-- Functionality may be added in the future -->
			<div class="row form-group">
				<label class="control-label col-xs-12 add_top_padding"><strong class="sub-content-heading"
																			   th:text="#{study.advance.plants.label}">PLANTS</strong><span
					class="required">*</span>
				</label>
			</div>
			<div class="row form-group">
				<label class="control-label col-xs-12 add_top_padding">
					<input type="radio" checked="checked" th:disabled="true"/> <span
					th:text="#{study.advance.plants.all.radio}">All plants are selected</span>
				</label>
			</div>
		</div>

		<div id="reps-section" th:unless="${#lists.isEmpty(replicationsChoices)}">
			<div class="row form-group">
				<label class="control-label col-xs-12 add_top_padding"><strong class="sub-content-heading" th:text="#{advancing.study.reps}">REPS</strong> </label>
			</div>
			<div class="row form-group">

				<div id="replications" class="col-xs-2" th:each="repIndex: ${replicationsChoices}">
					<input type="checkbox" class="replication" th:field="*{selectedReplications}" th:value="${repIndex}" ng-checked="checkall"/>
					<span class="label-bold" th:text="${repIndex}"></span>
				</div>
				<input type="checkbox" ng-model="checkall" ng-click="checkUncheckAll()" id="selectAllReps"/>
				<span class="label-bold" th:text="#{advancing.study.select.all}">Select All</span>

			</div>
		</div>

		<div id="harvest-details-section" th:style="${advanceType} != 'trial' ? 'display:block' : 'display:none'"> <!-- harvest details -->
			<div class="row form-group">
				<label class="control-label col-xs-12 add_top_padding"><strong class="sub-content-heading"
																			   th:text="#{advancing.study.harvest.information}">Harvest
					Details</strong><span class="required" th:if="${advanceType} == 'sample' ">*</span></label>
			</div>
			<div class="row form-group">
				<label class="control-label label-bold col-xs-6" th:text="#{advancing.study.harvest.date}">Harvest Date</label><span class="required"></span>

				<div class="col-xs-6">
					<div class="pull-left" style="padding-right: 20px">
						<select class="fbk-harvest-year" th:field="*{harvestYear}" style="width: 100px">
							<option th:each="year : ${yearChoices}" th:value="${year.val}" th:text="${year.name}">
							</option>
						</select>
					</div>
					<div class="pull-left">
						<select th:field="*{harvestMonth}" style="width: 100px">
							<option th:each="month : ${monthChoices}" th:value="${month.val}" th:text="${month.name}"></option>
						</select>
					</div>
				</div>

			</div>
		</div>

		<div id="advance-locations-section" th:if="${advanceType} == 'trial'">
			<div class="row form-group">
				<label class="control-label col-xs-12 add_top_padding"><strong class="sub-content-heading" th:text="#{advancing.study.location.information}">Location Details</strong> </label>
			</div>

			<div class="row form-group">
				<div class="col-xs-10" style="padding-left: 5%">
					<div id="location-details-section" class="row form-group">
						<table class='table table-curved table-condensed'>
							<thead>
							<tr>
								<th>{{locationsSelected[0]}}</th>
							</tr>
							</thead>
							<tbody>
							<tr ng-repeat="item in locationsSelected track by $index" ng-if="!$first">
								<td>{{item}}</td>
							</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</form>
</div> <!-- Modal Body -->
<div class="modal-footer">
	<button id="advanceStudyModalBack" type="button" class="btn btn-default" ng-click="back()" aria-hidden="true" th:text="#{common.form.back.text}">
		Back
	</button>
	<button type="button" class="btn btn-primary" aria-hidden="true" ng-click="advanceStudy()" th:text="#{common.form.finish.text}">
		Finish
	</button>
</div>
