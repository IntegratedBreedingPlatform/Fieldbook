<?xml version="1.0" encoding="ISO-8859-1"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:aop="http://www.springframework.org/schema/aop"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
       		http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context-3.2.xsd
            http://www.springframework.org/schema/mvc
            http://www.springframework.org/schema/mvc/spring-mvc.xsd
            http://www.springframework.org/schema/aop 
			http://www.springframework.org/schema/aop/spring-aop-3.2.xsd">

	<!-- Declare property file locations  -->
	<context:property-placeholder location="classpath:fieldbook.properties, classpath:test.properties" />

	<!-- **************************************************************** -->
	<!--  RESOURCE FOLDERS CONFIGURATION                                  -->
	<!--  Dispatcher configuration for serving static resources           -->
	<!-- **************************************************************** -->
	<mvc:resources mapping="/static/**" location="/WEB-INF/static/" /> 
       
	<!-- **************************************************************** -->
	<!--  SPRING ANNOTATION PROCESSING                                    -->
	<!-- **************************************************************** -->
	<mvc:annotation-driven />
	<context:component-scan base-package="com.efficio.fieldbook" />

	<!-- **************************************************************** -->
	<!-- MESSAGE EXTERNALIZATION/INTERNATIONALIZATION -->
	<!-- Standard Spring MessageSource implementation -->
	<!-- **************************************************************** -->
	<bean id="messageSource"
		class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basename" value="Messages" />
	</bean>

	<!-- **************************************************************** -->
	<!-- THYMELEAF-SPECIFIC ARTIFACTS -->
	<!-- TemplateResolver <- TemplateEngine <- ViewResolver -->
	<!-- **************************************************************** -->

	<bean id="templateResolver"
		class="org.thymeleaf.templateresolver.ServletContextTemplateResolver">
		<property name="prefix" value="/WEB-INF/pages/" />
		<property name="suffix" value=".html" />
		<property name="templateMode" value="HTML5" />
		<!-- Template cache is true by default. Set to false if you want -->
		<!-- templates to be automatically updated when modified. -->
		<property name="cacheable" value="false" />
	</bean>

	<bean id="templateEngine" class="org.thymeleaf.spring3.SpringTemplateEngine">
		<property name="templateResolver" ref="templateResolver" />
		<property name="additionalDialects">
        <set>
            <bean class="com.github.mxab.thymeleaf.extras.dataattribute.dialect.DataAttributeDialect"/>
        </set>
    </property>
	</bean>

	<bean class="org.thymeleaf.spring3.view.ThymeleafViewResolver">
		<property name="templateEngine" ref="templateEngine" />
	</bean>


	<!-- Application Beans -->

	<bean id="fieldbookService" class="com.efficio.fieldbook.service.FieldbookServiceImpl">
		<property name="designRunner" ref="designRunner"></property>
		<!-- <property name="designRunner" value="${design.runner}"></property> -->
	</bean>

	<bean id="designRunner" class="${design.runner}" />
	
	<bean id="workbenchService" class="com.efficio.fieldbook.service.WorkbenchServiceImpl" />

	<bean id="fileService" class="com.efficio.fieldbook.service.FileServiceImpl"
		init-method="init">
		<constructor-arg value="${upload.directory}" />
	</bean>
	
	<bean id="exportAdvanceListService" class="com.efficio.fieldbook.web.common.service.impl.ExportAdvanceListServiceImpl">
    </bean>    	
	
	<bean id="measurementsGeneratorService" class="com.efficio.fieldbook.web.nursery.service.impl.MeasurementsGeneratorServiceImpl">
	</bean>
	
	<bean id="importGermplasmfileService" class="com.efficio.fieldbook.web.nursery.service.impl.ImportGermplasmFileServiceImpl">
	</bean>

	<bean id="importWorkbookFileService" class="com.efficio.fieldbook.web.nursery.service.impl.ImportWorkbookFileServiceImpl">
	</bean>
	
	<bean id="fieldmapService" class="com.efficio.fieldbook.service.FieldMapServiceImpl">
	</bean>
	
	<bean id="verticalFieldMapLayoutIterator" class="com.efficio.fieldbook.web.label.printing.service.impl.VerticalFieldMapLayoutIterator">
	</bean>
	
	<bean id="horizontalFieldMapLayoutIterator" class="com.efficio.fieldbook.web.label.printing.service.impl.HorizontalFieldMapLayoutIterator">
	</bean>
	
	<bean id="labelPrintingService" class="com.efficio.fieldbook.service.LabelPrintingServiceImpl">
	</bean>

	<bean id="exportExcelService" class="com.efficio.fieldbook.service.ExportExcelServiceImpl" />
	
	<!-- to handle the issue in the abstract controller that needs httpservlet request -->
	<bean id="httpServletRequest" class="org.springframework.mock.web.MockHttpServletRequest">
	</bean>
	

	<bean id="multipartResolver"
		class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
		<!-- one of the properties available; the maximum file size in bytes -->
		<property name="maxUploadSize" value="10000000" />
	</bean>



	<bean id="advancingNursery" class="com.efficio.fieldbook.web.nursery.bean.AdvancingNursery"
		scope="session">
		<aop:scoped-proxy />
	</bean>
	
	<bean id="nurseryUserSelection" class="com.efficio.fieldbook.web.common.bean.UserSelection"
		scope="session">
		<aop:scoped-proxy />
	</bean>
	
	<bean id="seedSelection" class="com.efficio.fieldbook.web.inventory.bean.SeedSelection"
		scope="session">
		<aop:scoped-proxy />
	</bean>
		
	<bean id="userFieldmap" class="com.efficio.fieldbook.web.fieldmap.bean.UserFieldmap"
		scope="session">
		<aop:scoped-proxy />
	</bean>
	
	<bean id="userLabelPrinting" class="com.efficio.fieldbook.web.label.printing.bean.UserLabelPrinting"
		scope="session">
		<aop:scoped-proxy />
	</bean>

	<bean id="paginationListSelection" class="com.efficio.fieldbook.web.common.bean.PaginationListSelection"
		scope="session">
		<aop:scoped-proxy />
	</bean>
	
	<bean id="possibleValuesCache" class="com.efficio.fieldbook.web.nursery.bean.PossibleValuesCache"
		scope="session">
		<aop:scoped-proxy />
	</bean>
	
	<bean id="exportGermplasmListService" class="com.efficio.fieldbook.web.common.service.impl.ExportGermplasmListServiceImpl">
	</bean>
	
	<!-- **************************************************************** -->
	<!-- RESTful Web Service -->
	<!-- **************************************************************** -->

	<bean id="jsonConverter" class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter">
   		<property name="supportedMediaTypes" value="application/json" />
	</bean>

	<bean id="restTemplate" class="org.springframework.web.client.RestTemplate">
   		<property name="messageConverters">
       		<list>
           		<ref bean="jsonConverter" />
           		<bean class="org.springframework.http.converter.StringHttpMessageConverter" />
       		</list>
   		</property>    
	</bean>
	
	<bean id="exportService" class="org.generationcp.commons.service.impl.ExportServiceImpl"></bean>

	<!-- **************************************************************** -->
	<!-- MIDDLEWARE Database Managers -->
	<!-- **************************************************************** -->

    <bean id="managerFactoryProvider" class="org.generationcp.commons.hibernate.DefaultManagerFactoryProvider" destroy-method="close">   	
    	<property name="dbUsername" value="${local.username}"/>
    	<property name="dbPassword" value="${local.password}"/>
    	<property name="dbPort"     value="${workbench.port}"/>
    </bean>
    
     <bean id="ontologyDataManagerV2" class="org.generationcp.middleware.manager.OntologyDataManagerImpl">
        <property name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
    </bean>
    
    <bean id="germplasmDataManagerV2" class="org.generationcp.middleware.manager.GermplasmDataManagerImpl">
        <property name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
    </bean>

	<bean id="presetDataManager" class="org.generationcp.middleware.manager.PresetDataManagerImpl">
		<property name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
	</bean>
    
    <bean id="dataImportService" class="org.generationcp.middleware.service.DataImportServiceImpl">
        <constructor-arg name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
    </bean>
    
    <bean id="fieldbookMiddlewareService" class="org.generationcp.middleware.service.FieldbookServiceImpl">
        <constructor-arg name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
        <constructor-arg name="localDatabaseName" value="${local.db.name}"/>
    </bean>
    
    <bean id="inventoryMiddlewareService" class="org.generationcp.middleware.service.InventoryServiceImpl">
    	<constructor-arg name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
        <constructor-arg name="localDatabaseName" value="${local.db.name}"/>
    </bean>
    
    
    <bean id="ontologyService" class="org.generationcp.middleware.service.OntologyServiceImpl">
        <constructor-arg name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
    </bean>
    
    <bean id="studyDataManagerV2" class="org.generationcp.middleware.manager.StudyDataManagerImpl">
        <property name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
    </bean>
    
    <bean id="germplasmListManager" class="org.generationcp.middleware.manager.GermplasmListManagerImpl">
        <property name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
    </bean>
    
    <bean id="userDataManager" class="org.generationcp.middleware.manager.UserDataManagerImpl">
    	<property name="sessionProvider" ref="ibdbHibernateSessionProvider"/>
    </bean>

    <bean id="ibdbHibernateSessionProvider" class="org.generationcp.middleware.hibernate.HibernateSessionPerRequestProvider" scope="singleton" destroy-method="close">
        <property name="sessionFactory" ref="ibdbSessionFactory"/>
        <aop:scoped-proxy proxy-target-class="false"/>
    </bean>


	<bean id="workbenchSessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
        <property name="dataSource" ref="workbenchDataSource"/>
        <property name="configLocation" value="classpath:ibpworkbench_hib.cfg.xml"/>
    </bean>
    
    <bean id="ibdbSessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
        <property name="dataSource" ref="ibdbDataSource"/>
        <property name="configLocation" value="classpath:ibpmidware_hib.cfg.xml"/>
    </bean>
    
    <bean id="ibdbDataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="${workbench.driver}"/>
        <property name="url" value="${local.url}"/>
        <property name="username" value="${workbench.username}"/>
        <property name="password" value="${workbench.password}"/>
    </bean>
    
    <bean id="workbenchDataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName" value="${workbench.driver}"/>
        <property name="url" value="${workbench.url}"/>
        <property name="username" value="${workbench.username}"/>
        <property name="password" value="${workbench.password}"/>
    </bean>
	
	 <bean id="workbenchHibernateSessionProvider" class="org.generationcp.middleware.hibernate.HibernateSessionPerRequestProvider" scope="singleton" destroy-method="close">
        <property name="sessionFactory" ref="workbenchSessionFactory"/>
        
        <!-- JDK Standard Proxy around this request scoped bean, so we can use it on longer scoped beans -->
        <aop:scoped-proxy proxy-target-class="false"/>
    </bean>
	
	<bean id="workbenchDataManager"
        class="org.generationcp.middleware.manager.WorkbenchDataManagerImpl">
        <constructor-arg ref="workbenchHibernateSessionProvider" />
    </bean>
	
	<bean id="fieldbookProperties" class="com.efficio.fieldbook.web.util.FieldbookProperties">
		<property name="programLocationsUrl" value="${url.program.locations}" />
		<property name="programBreedingMethodsUrl" value="${url.program.breeding.methods}" />
		<property name="germplasmImportUrl" value="${url.germplasm.import}" />
		<property name="germplasmDetailsUrl" value="${url.germplasm.details}" />	
		<property name="uploadDirectory" value="${upload.directory}" />	
	</bean>

    <bean id="processCodeFactory" class="com.efficio.fieldbook.web.naming.impl.ProcessCodeFactory" init-method="init">
        <!--TODO : possibly find a way to make list based on component scan of a certain package-->
        <property name="registeredExpressions">
            <list>
                <bean class="com.efficio.fieldbook.web.naming.expression.BracketsExpression"/>
                <bean class="com.efficio.fieldbook.web.naming.expression.BulkCountExpression"/>
                <bean class="com.efficio.fieldbook.web.naming.expression.FirstExpression"/>
                <bean class="com.efficio.fieldbook.web.naming.expression.LocationAbbreviationExpression"/>
                <bean class="com.efficio.fieldbook.web.naming.expression.NumberExpression"/>
                <bean class="com.efficio.fieldbook.web.naming.expression.SeasonExpression"/>
                <bean class="com.efficio.fieldbook.web.naming.expression.SequenceExpression"/>
                <bean class="com.efficio.fieldbook.web.naming.expression.TopLocationAbbreviationExpression"/>
            </list>
        </property>
    </bean>

	<bean id="settingsService" class="com.efficio.fieldbook.service.SettingsServiceImpl"/>
	
	<bean id="programUUIDFactory" class="org.generationcp.commons.spring.util.ProgramUUIDFactory"
          scope="request">
        <aop:scoped-proxy/>
    </bean>

	<bean id="settingsPresetService" class="org.generationcp.commons.service.impl.SettingsPresetServiceImpl"/>
	
	<bean id="crossingService"
          class="com.efficio.fieldbook.web.nursery.service.impl.CrossingServiceImpl">
    </bean>
    
    <bean id="crossNameService" class="org.generationcp.commons.service.impl.CrossNameServiceImpl">
        <aop:scoped-proxy/>
    </bean>

    <bean id="crossingTemplateParser"
          class="com.efficio.fieldbook.web.nursery.service.impl.CrossingTemplateParser"
          scope="request">
        <aop:scoped-proxy/>
    </bean>
    
</beans>
